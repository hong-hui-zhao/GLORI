
è¿™ä¸ª Python è„šæœ¬çš„æ ¸å¿ƒç›®çš„ï¼Œæ˜¯å°†æ ‡å‡†çš„ GTFï¼ˆGene Transfer Formatï¼‰åŸºå› æ³¨é‡Šæ–‡ä»¶è½¬æ¢æˆä¸€ç§æ›´æ˜“äºä¸‹æ¸¸åˆ†æä½¿ç”¨çš„ç»“æ„åŒ–æ³¨é‡Šæ–‡ä»¶ï¼Œç‰¹åˆ«æ˜¯é’ˆå¯¹æ¯ä¸ªè½¬å½•æœ¬çš„å¤–æ˜¾å­ç»“æ„ä¿¡æ¯ã€‚
GTF æ–‡ä»¶æœ¬èº«æ˜¯ä¸€ç§å¹¿æ³›ä½¿ç”¨çš„åŸºå› æ³¨é‡Šæ ¼å¼ï¼Œå®ƒè®°å½•äº†åŸºå› ã€è½¬å½•æœ¬ã€å¤–æ˜¾å­ã€CDS ç­‰ä¿¡æ¯ï¼Œä½†æ¯æ¡ä¿¡æ¯åˆ†æ•£åœ¨æ–‡ä»¶çš„ä¸åŒåˆ—å’Œä¸åŒè¡Œä¸­ï¼Œå¹¶ä¸”ç›´æ¥ä½¿ç”¨ GTF æ–‡ä»¶åšä¸‹æ¸¸åˆ†æï¼ˆå¦‚ RNA-seq å®šé‡åˆ†æã€å¯è§†åŒ–æˆ–è€…å¤–æ˜¾å­å¯å˜å‰ªæ¥åˆ†æï¼‰ä¸å¤Ÿæ–¹ä¾¿ï¼Œå› æ­¤éœ€è¦å¯¹ GTF æ–‡ä»¶è¿›è¡Œè§£æå’Œæ•´ç†ã€‚

è„šæœ¬é¦–å…ˆé€šè¿‡å¯¼å…¥ `re` å’Œ `argparse` æ¨¡å—å®ç°åŸºæœ¬åŠŸèƒ½ï¼Œå…¶ä¸­ `re` ç”¨äºåœ¨å­—ç¬¦ä¸²ä¸­åŒ¹é…å’Œæå– `gene_id`ã€`transcript_id` ç­‰å…³é”®ä¿¡æ¯ï¼Œè€Œ `argparse` åˆ™ç”¨äºåœ¨å‘½ä»¤è¡Œä¸­ä¼ å…¥è¾“å…¥æ–‡ä»¶è·¯å¾„å’Œè¾“å‡ºæ–‡ä»¶è·¯å¾„ã€‚

è„šæœ¬å®šä¹‰äº† `get_geneanno` å‡½æ•°ï¼Œè¯¥å‡½æ•°çš„ä½œç”¨æ˜¯æ ¹æ®å‰é¢æ•´ç†å¥½çš„åŸºå› åˆ—è¡¨ç”Ÿæˆæ³¨é‡Šæ–‡ä»¶ï¼Œé¦–å…ˆæ‰“å¼€è¾“å‡ºæ–‡ä»¶ï¼Œå¹¶åˆå§‹åŒ–ä¸€ä¸ªåˆ—è¡¨ç”¨äºå­˜å‚¨æ¯æ¡æ³¨é‡Šè®°å½•ã€‚

ç„¶åæ‰“å¼€è¾“å…¥çš„ GTF æ–‡ä»¶ï¼Œé€è¡Œè¯»å–ï¼ŒæŒ‰åˆ¶è¡¨ç¬¦åˆ†å‰²æ¯è¡Œæ•°æ®ï¼Œå¦‚æœå½“å‰è¡Œæ˜¯æ³¨é‡Šè¡Œï¼ˆä»¥ `#` å¼€å¤´ï¼‰æˆ–è€…ä¸æ˜¯ `gene` ç±»å‹ï¼Œåˆ™è·³è¿‡ï¼Œå› ä¸ºè¿™äº›è¡Œä¸åŒ…å«ç›´æ¥éœ€è¦çš„æ³¨é‡Šä¿¡æ¯ã€‚

åœ¨è§£ææ¯æ¡ `gene` è¡Œæ—¶ï¼Œè„šæœ¬æå–æŸ“è‰²ä½“ä¿¡æ¯ï¼ˆ`chr`ï¼‰ã€é“¾æ–¹å‘ï¼ˆ`dir`ï¼‰ï¼Œä»¥åŠåŸºå› çš„èµ·æ­¢ä½ç½®ï¼ˆ`start`, `end`ï¼‰ï¼Œè¿™é‡Œç‰¹åˆ«æ³¨æ„ GTF æ–‡ä»¶çš„ `start` æ˜¯ 1-based åæ ‡ï¼Œå› æ­¤éœ€è¦å‡ 1 è½¬æ¢ä¸º 0-based åæ ‡ä»¥å…¼å®¹ä¸‹æ¸¸å·¥å…·ï¼Œå¦‚ BED æ–‡ä»¶æ ¼å¼ã€‚

éšåï¼Œè„šæœ¬ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ä»å±æ€§åˆ—ä¸­æå– `gene_id` å’Œ `gene_biotype`ï¼Œå¹¶å¯¹å­—å…¸ `dictInfo` è¿›è¡Œåˆå§‹åŒ–ï¼Œå¦‚æœè¯¥åŸºå› æˆ–è½¬å½•æœ¬å°šæœªè®°å½•ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªåŒ…å«å¤–æ˜¾å­èµ·æ­¢ä½ç½®åˆ—è¡¨ã€é“¾æ–¹å‘ã€æŸ“è‰²ä½“ã€åŸºå›  ID çš„å­—å…¸æ¡ç›®ï¼Œç„¶åå°†å½“å‰å¤–æ˜¾å­èµ·æ­¢ä½ç½®åŠ å…¥åˆ°å¯¹åº”åˆ—è¡¨ä¸­ã€‚æ•´ä¸ªè¿‡ç¨‹ä½¿ç”¨äº† `try-except` è¯­å¥å—æ¥è·³è¿‡ç¼ºå¤±å­—æ®µæˆ–æ— æ³•è§£æçš„è¡Œï¼Œä»è€Œæé«˜è„šæœ¬çš„é²æ£’æ€§ï¼Œé¿å…åœ¨é¢å¯¹ä¸è§„èŒƒçš„ GTF æ–‡ä»¶æ—¶æŠ¥é”™ä¸­æ–­ã€‚

åœ¨ä¸»ç¨‹åºä¸­ï¼Œè„šæœ¬å†æ¬¡éå† GTF æ–‡ä»¶ï¼Œä½†è¿™æ¬¡å…³æ³¨çš„æ˜¯ `transcript_id` ç›¸å…³çš„è¡Œï¼Œè·³è¿‡æ³¨é‡Šå’Œ `gene` ç±»å‹è¡Œï¼Œæå–æ¯æ¡è½¬å½•æœ¬çš„å¤–æ˜¾å­ä½ç½®ä¿¡æ¯ï¼Œå¹¶å°†å…¶å­˜å…¥åŒæ ·çš„ `dictInfo` å­—å…¸ä¸­ï¼Œæ¯ä¸ªè½¬å½•æœ¬åŒ…å«å…¶é“¾æ–¹å‘ã€æŸ“è‰²ä½“ã€åŸºå›  ID ä»¥åŠæ‰€æœ‰å¤–æ˜¾å­çš„èµ·æ­¢ä½ç½®ï¼Œå¤–æ˜¾å­ç±»å‹åŒ…æ‹¬ `exon` å’Œ `tRNAscan`ã€‚è„šæœ¬è¿˜å°è¯•æå– `gene_name`ï¼Œå¦‚æœæ²¡æœ‰åˆ™ç”¨ `gene_id` ä»£æ›¿ã€‚å®Œæˆéå†åï¼Œè„šæœ¬é€šè¿‡æ”¶é›†æ‰€æœ‰è½¬å½•æœ¬å¯¹åº”çš„ `gene_id` æ¥ç”Ÿæˆä¸€ä¸ªå»é‡çš„åŸºå› åˆ—è¡¨ `list_gene`ï¼Œç¡®ä¿åœ¨ç”Ÿæˆæœ€ç»ˆæ³¨é‡Šæ–‡ä»¶æ—¶ä¸ä¼šé‡å¤è®°å½•åŒä¸€åŸºå› ã€‚éšåï¼Œ`get_geneanno` å‡½æ•°è¢«è°ƒç”¨ï¼Œå¯¹æ¯ä¸ªè½¬å½•æœ¬è¿›è¡Œå¤„ç†ï¼šé¦–å…ˆè®¡ç®—å¤–æ˜¾å­æ•°é‡ï¼Œå°†å¤–æ˜¾å­èµ·æ­¢ä½ç½®æŒ‰å‡åºæ’åºå¹¶ä»¥é€—å·åˆ†éš”ï¼Œæ‹¼æ¥æˆä¸€è¡Œæ ‡å‡†åŒ–çš„æ³¨é‡Šä¿¡æ¯ï¼ŒåŒ…æ‹¬è½¬å½•æœ¬ IDã€æŸ“è‰²ä½“ã€é“¾æ–¹å‘ã€å¤–æ˜¾å­æ•°é‡ã€å¤–æ˜¾å­èµ·æ­¢åæ ‡ã€åŸºå›  ID ç­‰å­—æ®µï¼Œå¹¶å†™å…¥è¾“å‡ºæ–‡ä»¶ã€‚

æ•´ä¸ªè„šæœ¬çš„è®¾è®¡é€»è¾‘ä½“ç°äº†å‡ ä¸ªå…³é”®ç›®çš„ï¼šé¦–å…ˆï¼Œå®ƒå®ç°äº† **GTF æ–‡ä»¶åˆ°ç»“æ„åŒ–æ³¨é‡Šæ–‡ä»¶çš„è½¬æ¢**ï¼Œå°†åˆ†æ•£åœ¨ä¸åŒåˆ—å’Œè¡Œçš„ä¿¡æ¯æ•´åˆåˆ°ä»¥è½¬å½•æœ¬ä¸ºå•ä½çš„å­—å…¸ä¸­ï¼Œä¾¿äºåç»­åˆ†æã€‚å…¶æ¬¡ï¼Œå®ƒç²¾ç¡®è®°å½•äº†æ¯ä¸ªè½¬å½•æœ¬çš„å¤–æ˜¾å­ç»“æ„ï¼Œè¿™æ˜¯ RNA-seq å®šé‡åˆ†æã€å¯å˜å‰ªæ¥åˆ†æå’ŒåŸºå› ç»“æ„å¯è§†åŒ–çš„åŸºç¡€æ•°æ®ã€‚ç¬¬ä¸‰ï¼Œè„šæœ¬å¤„ç†äº† **1-based åˆ° 0-based åæ ‡çš„è½¬æ¢**ï¼Œä¿è¯ç”Ÿæˆçš„æ³¨é‡Šæ–‡ä»¶ä¸å¤§å¤šæ•°ä¸‹æ¸¸åˆ†æå·¥å…·ï¼ˆå¦‚ BED æ–‡ä»¶å¤„ç†å·¥å…·ã€å¯è§†åŒ–å·¥å…·ï¼‰å…¼å®¹ã€‚ç¬¬å››ï¼Œå®ƒå¯¹å¼‚å¸¸æƒ…å†µè¿›è¡Œäº†å®¹é”™å¤„ç†ï¼Œä¾‹å¦‚ç¼ºå°‘ `gene_id` æˆ– `transcript_id` çš„è¡Œä¼šè¢«è‡ªåŠ¨è·³è¿‡ï¼Œä»è€Œå¢å¼ºäº†è„šæœ¬çš„é²æ£’æ€§ã€‚æœ€åï¼Œé€šè¿‡å»é‡åŸºå›  IDï¼Œä¿è¯è¾“å‡ºæ–‡ä»¶ä¸ä¼šé‡å¤è®°å½•ç›¸åŒåŸºå› ï¼Œä¾¿äºç­›é€‰ç‰¹å®šåŸºå› é›†åˆè¿›è¡Œåˆ†æã€‚æ€»è€Œè¨€ä¹‹ï¼Œä½œè€…é€šè¿‡è¿™ä¸€ç³»åˆ—æ­¥éª¤å®ç°äº†ä»åŸå§‹ GTF æ–‡ä»¶æå–ã€æ•´ç†ã€å»é‡å¹¶æ ¼å¼åŒ–è¾“å‡ºè½¬å½•æœ¬å’Œå¤–æ˜¾å­ä¿¡æ¯çš„åŠŸèƒ½ï¼Œç”Ÿæˆçš„æ³¨é‡Šæ–‡ä»¶ä¸ä»…ç»“æ„æ¸…æ™°ï¼Œè€Œä¸”ç›´æ¥å¯ç”¨äºä¸‹æ¸¸åˆ†ææµç¨‹ï¼Œæå¤§åœ°æé«˜äº†åŸºå› æ³¨é‡Šæ•°æ®çš„å¯æ“ä½œæ€§å’Œå…¼å®¹æ€§ã€‚


``` Python
import re      # å¯¼å…¥æ­£åˆ™è¡¨è¾¾å¼æ¨¡å—ï¼Œç”¨äºåœ¨å­—ç¬¦ä¸²ä¸­æœç´¢ gene_id æˆ– transcript_id
import argparse # å¯¼å…¥å‘½ä»¤è¡Œå‚æ•°è§£ææ¨¡å—ï¼Œç”¨äºä¼ å…¥è¾“å…¥è¾“å‡ºæ–‡ä»¶è·¯å¾„

# å®šä¹‰å‡½æ•° get_geneannoï¼Œç”¨äºæ ¹æ® list_gene ç”Ÿæˆæ³¨é‡Šæ–‡ä»¶
def get_geneanno(list_gene):
    lw = open(options.output, 'w+')  # æ‰“å¼€è¾“å‡ºæ–‡ä»¶ï¼Œä»¥å†™å…¥æ¨¡å¼
    list_tt = []                     # åˆå§‹åŒ–åˆ—è¡¨ï¼Œç”¨äºå­˜å‚¨æ¯æ¡åŸºå› æ³¨é‡Šä¿¡æ¯

    # æ‰“å¼€è¾“å…¥çš„ GTF æ–‡ä»¶
    with open(options.input, 'r') as gtf:
        line = gtf.readline()        # è¯»å–æ–‡ä»¶çš„ç¬¬ä¸€è¡Œ
        while line:                  # å¾ªç¯è¯»å–æ–‡ä»¶çš„æ¯ä¸€è¡Œ
            row = line.strip().split("\t")  # æŒ‰åˆ¶è¡¨ç¬¦åˆ†å‰²æ¯è¡Œï¼Œå¾—åˆ°å„åˆ—ä¿¡æ¯
            if line.startswith("#") or row[2] != 'gene':
                # å¦‚æœæ˜¯æ³¨é‡Šè¡Œï¼ˆ#å¼€å¤´ï¼‰æˆ–è€…ä¸æ˜¯ gene ç±»å‹ï¼Œè·³è¿‡
                line = gtf.readline()
                continue

            # æå–æŸ“è‰²ä½“ä¿¡æ¯
            chr = row[0]            
            # æå–é“¾æ–¹å‘ï¼ˆ+ æˆ– -ï¼‰
            dir = row[6]            

            # æå–åŸºå› èµ·æ­¢ä½ç½®
            # GTF æ–‡ä»¶ start æ˜¯ 1-basedï¼Œéœ€è¦å‡ 1 è½¬ä¸º 0-based
            start, end = int(row[3]) - 1, int(row[4])

            try:
                # ç”¨æ­£åˆ™åœ¨æ¯åˆ—é‡Œæ‰¾åŒ…å« gene_id çš„å­—ç¬¦ä¸²ï¼Œå¹¶åˆ†å‰²æˆåˆ—è¡¨
                row2 = [i.split(" ") for i in row if re.search('gene_id', i)][0]
                # è·å– gene_id å¹¶å»æ‰å¼•å·å’Œåˆ†å·
                gene_id = row2[row2.index("gene_id") + 1].replace('\"', '').strip(";")

                if gene_id not in list_gene:  # å¦‚æœåŸºå› ä¸åœ¨ç›®æ ‡åˆ—è¡¨é‡Œ
                    trans_id = gene_id        # ä½¿ç”¨ gene_id ä½œä¸ºè½¬å½•æœ¬ ID
                    # è·å–åŸºå› ç±»å‹ï¼ˆgene_biotypeï¼‰
                    gene_biotype = row2[row2.index("gene_biotype") + 1].replace('\"', '').strip(";")

                    # å¦‚æœè¯¥è½¬å½•æœ¬ ID å°šæœªè®°å½•ï¼Œåˆ™åˆå§‹åŒ–å­—å…¸
                    if trans_id not in dictInfo:
                        dictInfo[trans_id] = {
                            'start': [],   # å¤–æ˜¾å­èµ·å§‹ä½ç½®åˆ—è¡¨
                            'end': [],     # å¤–æ˜¾å­ç»“æŸä½ç½®åˆ—è¡¨
                            'dir': "",     # é“¾æ–¹å‘
                            'chr': "",     # æŸ“è‰²ä½“
                            'gene_id': ""  # åŸºå› ID
                        }
                        dictInfo[trans_id]['dir'] = dir
                        dictInfo[trans_id]['chr'] = chr
                        dictInfo[trans_id]['gene_id'] = gene_id
                        # ä¿å­˜å¤–æ˜¾å­èµ·æ­¢ä½ç½®
                        dictInfo[trans_id]['start'].append(start)
                        dictInfo[trans_id]['end'].append(end)
                # è¯»å–ä¸‹ä¸€è¡Œ
                line = gtf.readline()
            except ValueError:
                # å¦‚æœè¡Œé‡Œæ²¡æœ‰ gene_idï¼Œåˆ™è·³è¿‡
                line = gtf.readline()

        # éå† dictInfo ä¸­æ‰€æœ‰è½¬å½•æœ¬ï¼Œç”Ÿæˆæ³¨é‡Šè¡Œ
        for trans_id in dictInfo.keys():
            exonCount = str(len(dictInfo[trans_id]['start']))  # å¤–æ˜¾å­æ•°é‡
            # å¤–æ˜¾å­èµ·å§‹ä½ç½®ï¼ŒæŒ‰å‡åºæ’åºå¹¶ç”¨é€—å·åˆ†éš”ï¼Œæœ«å°¾åŠ é€—å·
            exonStarts = ','.join([str(i) for i in sorted(dictInfo[trans_id]['start'])]) + ","
            # å¤–æ˜¾å­ç»“æŸä½ç½®ï¼ŒæŒ‰å‡åºæ’åºå¹¶ç”¨é€—å·åˆ†éš”ï¼Œæœ«å°¾åŠ é€—å·
            exonEnds = ','.join([str(i) for i in sorted(dictInfo[trans_id]['end'])]) + ","
            # æ‹¼æ¥æ³¨é‡Šè¡Œ
            list_tt.append("\t".join([
                '.', trans_id, dictInfo[trans_id]['chr'], dictInfo[trans_id]['dir'],
                'txStart', 'txEnd', 'cdsStart', 'cdsEnd',
                exonCount, exonStarts, exonEnds,
                ".", dictInfo[trans_id]['gene_id'], '.', '.', '.'
            ]))
    # å°†æ‰€æœ‰æ³¨é‡Šè¡Œå†™å…¥è¾“å‡ºæ–‡ä»¶
    lw.writelines("\n".join(list_tt) + "\n")
    lw.close()  # å…³é—­è¾“å‡ºæ–‡ä»¶


if __name__ == "__main__":
    # å‘½ä»¤è¡Œå‚æ•°è§£æ
    usage = "Usage: python %prog -i <gtf> > output.anno"
    parser = argparse.ArgumentParser(usage=usage)
    # è¾“å…¥ GTF æ–‡ä»¶è·¯å¾„
    parser.add_argument("-i", dest="input", help="Input GTF file")
    # è¾“å‡ºæ³¨é‡Šæ–‡ä»¶è·¯å¾„
    parser.add_argument("-o", dest="output", help="Output annotation file")
    options = parser.parse_args()

    # åˆå§‹åŒ–å­—å…¸å’ŒåŸºå› åˆ—è¡¨
    dictInfo = {}  # ç”¨äºå­˜å‚¨è½¬å½•æœ¬ä¿¡æ¯
    list_gene = [] # ç”¨äºå­˜å‚¨åŸºå›  ID

    # ç¬¬ä¸€éè¯»å– GTF æ–‡ä»¶ï¼Œè·å–è½¬å½•æœ¬å’Œå¤–æ˜¾å­ä¿¡æ¯
    with open(options.input, 'r') as gtf:
        line = gtf.readline()  # è¯»å–ç¬¬ä¸€è¡Œ
        while line:            # å¾ªç¯æ¯è¡Œ
            row = line.strip().split("\t")  # åˆ†åˆ—
            if line.startswith("#") or row[2] == 'gene':
                # å¦‚æœæ˜¯æ³¨é‡Šè¡Œæˆ–è€… gene ç±»å‹è¡Œï¼Œè·³è¿‡
                line = gtf.readline()
                continue

            # æå–æŸ“è‰²ä½“å’Œé“¾æ–¹å‘
            chr = row[0]
            dir = row[6]

            # æå–å¤–æ˜¾å­èµ·æ­¢ä½ç½®ï¼ˆ0-basedï¼‰
            start, end = int(row[3]) - 1, int(row[4])

            try:
                # æ‰¾åˆ° transcript_id æ‰€åœ¨åˆ—
                row2 = [i.split(" ") for i in row if re.search('transcript_id', i)][0]
                trans_id = row2[row2.index("transcript_id") + 1].replace('\"', '').strip(";")
                gene_id = row2[row2.index("gene_id") + 1].replace('\"', '').strip(";")
                try:
                    # å°è¯•æå– gene åç§°ï¼Œå¦‚æœæ²¡æœ‰åˆ™ç”¨ gene_id
                    gene_name = row2[row2.index("gene") + 1].replace('\"', '').strip(";")
                except ValueError:
                    gene_name = gene_id

                type = row[2]  # è·å–ç±»å‹ï¼šexon, CDS ç­‰

                # å¦‚æœè¯¥è½¬å½•æœ¬ ID å°šæœªè®°å½•ï¼Œåˆ™åˆå§‹åŒ–
                if trans_id not in dictInfo:
                    dictInfo[trans_id] = {
                        'start': [], 'end': [], 'dir': "", 'chr': "", 'gene_id': ""
                    }
                    dictInfo[trans_id]['dir'] = dir
                    dictInfo[trans_id]['chr'] = chr
                    dictInfo[trans_id]['gene_id'] = gene_id

                # å¦‚æœæ˜¯ exon æˆ– tRNAscanï¼Œåˆ™ä¿å­˜èµ·æ­¢ä½ç½®
                if type == "exon" or type == "tRNAscan":
                    dictInfo[trans_id]['start'].append(start)
                    dictInfo[trans_id]['end'].append(end)
                # è¯»å–ä¸‹ä¸€è¡Œ
                line = gtf.readline()
            except ValueError:
                # å¦‚æœæ²¡æœ‰ transcript_id åˆ—ï¼Œè·³è¿‡
                line = gtf.readline()

    # æ”¶é›†æ‰€æœ‰åŸºå›  ID åˆ° list_gene
    for trans_id in dictInfo.keys():
        gene_name2 = dictInfo[trans_id]['gene_id']
        if gene_name2 not in list_gene:
            list_gene.append(gene_name2)

    # è°ƒç”¨å‡½æ•°ç”Ÿæˆæœ€ç»ˆæ³¨é‡Šæ–‡ä»¶
    get_geneanno(list_gene)


```


## ğŸ”¹ ä¸€ã€å…ˆçœ‹ GTF æ–‡ä»¶ç»“æ„

GTF æ–‡ä»¶çš„å…¸å‹ä¸€è¡Œå¤§è‡´å¦‚ä¸‹ï¼ˆä»¥ Ensembl ä¸ºä¾‹ï¼‰ï¼š

```
NC_000001.11    BestRefSeq      gene    11874   14409   .       +       .       gene_id "DDX11L1"; db_xref "GeneID:100287102"; db_xref "HGNC:HGNC:37102"; description "DEAD/H-box helicase 11 like 1"; gbkey "Gene"; gene "DDX11L1"; gene_biotype "transcribed_pseudogene"; pseudo "true"; 
```

GTF æ–‡ä»¶æ¯è¡Œåˆ†ä¸º **9 åˆ—**ï¼ˆç”¨ `\t` åˆ†éš”ï¼‰ï¼š

| åˆ—å·  | åç§°         | ç¤ºä¾‹å†…å®¹                                                                                                                                                                                                       | è¯´æ˜                                  |
| --- | ---------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------- |
| 1   | seqname    | NC_000001.11                                                                                                                                                                                               | æŸ“è‰²ä½“(éœ€è¦è·ŸNCBIå¯¹åº”)                      |
| 2   | source     | BestRefSeq                                                                                                                                                                                                 | æ•°æ®æ¥æº                                |
| 3   | feature    | gene                                                                                                                                                                                                       | ç‰¹å¾ç±»å‹ï¼ˆgene, transcript, exon, CDS ç­‰ï¼‰ |
| 4   | start      | 11874                                                                                                                                                                                                      | èµ·å§‹ä½ç½®                                |
| 5   | end        | 14409                                                                                                                                                                                                      | ç»ˆæ­¢ä½ç½®                                |
| 6   | score      | .                                                                                                                                                                                                          | åˆ†å€¼æˆ–ç©º                                |
| 7   | strand     | +                                                                                                                                                                                                          | é“¾æ–¹å‘                                 |
| 8   | frame      | .                                                                                                                                                                                                          | è¯»ç æ¡†                                 |
| 9   | attributes | gene_id "DDX11L1"; db_xref "GeneID:100287102"; db_xref "HGNC:HGNC:37102"; description "DEAD/H-box helicase 11 like 1"; gbkey "Gene"; gene "DDX11L1"; gene_biotype "transcribed_pseudogene"; pseudo "true"; | é¢å¤–å±æ€§å­—æ®µ                              |

å‰ 8 åˆ—ç»“æ„å›ºå®šï¼Œç¬¬ 9 åˆ— `"attributes"` å­˜æ”¾äº†å¤šä¸ªé”®å€¼å¯¹ï¼Œç”¨åˆ†å· `;` åˆ†éš”ï¼Œç”¨å¼•å·åŒ…è£¹å€¼ã€‚

---

## ğŸ”¹ äºŒã€ä»£ç é€è¡Œè§£é‡Š


```python
row2 = [i.split(" ") for i in row if re.search('transcript_id', i)][0]
trans_id = row2[row2.index("transcript_id") + 1].replace('\"', '').strip(";")
gene_id = row2[row2.index("gene_id") + 1].replace('\"', '').strip(";")
try:
    gene_name = row2[row2.index("gene") + 1].replace('\"', '').strip(";")
except ValueError:
    gene_name = gene_id
```

å‡è®¾è¿™æ—¶ï¼š

```python
row = [
 'NC_000001.11'  ,  'BestRefSeq'   ,   'gene' ,   '11874' ,  '14409'  , '.'   ,    '+'   ,    '.'   ,    'gene_id' ,'DDX11L1;' ,'db_xref' ,'GeneID:100287102;' ,'db_xref' ,'HGNC:HGNC:37102;' 'description "DEAD/H-box helicase 11 like 1";' 'gbkey' ,'"Gene";' 'gene', '"DDX11L1";' ,'gene_biotype' ,'"transcribed_pseudogene";' 'pseudo', "true"
]
```

---

### ç¬¬ä¸€æ­¥ï¼š

```python
row2 = [i.split(" ") for i in row if re.search('transcript_id', i)][0]
```

è§£é‡Šï¼š

* `for i in row`ï¼šéå†å½“å‰è¡Œçš„æ¯ä¸ªå­—æ®µã€‚
  å› ä¸º `row` æ˜¯é€šè¿‡ `row = line.strip().split("\t")` å¾—åˆ°çš„ï¼Œæ‰€ä»¥ç¬¬ 9 åˆ—æ˜¯æ•´ä¸ªå±æ€§å­—æ®µã€‚
* `if re.search('transcript_id', i)`ï¼šç”¨æ­£åˆ™è¡¨è¾¾å¼æŸ¥æ‰¾åŒ…å« â€œtranscript_idâ€ çš„é‚£ä¸€åˆ—ã€‚
  ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåªæœ‰ç¬¬ 9 åˆ—ï¼ˆattributesï¼‰ä¼šåŒ¹é…,å–exonã€‚
* `i.split(" ")`ï¼šæŠŠè¿™ä¸€æ•´åˆ—æŒ‰ç…§ç©ºæ ¼åˆ†å‰²æˆå•è¯åˆ—è¡¨ã€‚

ä¸¾ä¾‹ï¼š

```python
i = 'gene_id "ENSG00000223972"; transcript_id "ENST00000456328"; gene_name "DDX11L1"; gene_biotype "pseudogene";'
i.split(" ") = [
  'gene_id', '"ENSG00000223972";', 'transcript_id', '"ENST00000456328";',
  'gene_name', '"DDX11L1";', 'gene_biotype', '"pseudogene";'
]
```

* `[ ... ][0]` è¡¨ç¤ºå–åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆå› ä¸ºåªä¼šæ‰¾åˆ°ä¸€ä¸ªåŒ¹é…ï¼‰ã€‚

æ­¤æ—¶ï¼š

```python
row2 = [
  'gene_id', '"ENSG00000223972";', 'transcript_id', '"ENST00000456328";',
  'gene_name', '"DDX11L1";', 'gene_biotype', '"pseudogene";'
]
```

---

### ç¬¬äºŒæ­¥ï¼šæå– transcript_id

```python
trans_id = row2[row2.index("transcript_id") + 1].replace('\"', '').strip(";")
```

è§£é‡Šï¼š

* `row2.index("transcript_id")` æ‰¾åˆ° `"transcript_id"` æ‰€åœ¨çš„ä½ç½®ç´¢å¼•ã€‚
  åœ¨ä¸Šä¾‹ä¸­ï¼Œå®ƒæ˜¯ç´¢å¼• 2ã€‚
* `+ 1` å–å…¶åä¸€ä¸ªå…ƒç´ ï¼š`'"ENST00000456328";'`ã€‚
* `.replace('\"', '')` åˆ é™¤å¼•å· `" "`ã€‚
* `.strip(";")` å»æ‰æœ«å°¾çš„åˆ†å· `;`ã€‚

ç»“æœï¼š

```python
trans_id = 'ENST00000456328'
```

---

### ç¬¬ä¸‰æ­¥ï¼šæå– gene_id

```python
gene_id = row2[row2.index("gene_id") + 1].replace('\"', '').strip(";")
```

é€»è¾‘å®Œå…¨ç›¸åŒï¼š

* æ‰¾åˆ° `"gene_id"` çš„ä½ç½®ï¼ˆç´¢å¼• 0ï¼‰ã€‚
* å–ä¸‹ä¸€ä¸ªå…ƒç´  `"ENSG00000223972";`ã€‚
* å»æ‰å¼•å·å’Œåˆ†å·ã€‚

ç»“æœï¼š

```python
gene_id = 'ENSG00000223972'
```

---

### ç¬¬å››æ­¥ï¼šå°è¯•æå– gene_name

```python
try:
    gene_name = row2[row2.index("gene") + 1].replace('\"', '').strip(";")
except ValueError:
    gene_name = gene_id
```

è§£é‡Šï¼š

* `row2.index("gene")` å°è¯•åœ¨åˆ—è¡¨ä¸­æŸ¥æ‰¾ `"gene"`ã€‚
  æ³¨æ„ï¼Œè¿™é‡Œæœ‰ç‚¹æ¨¡ç³Šï¼Œå› ä¸ºæ­£ç¡®çš„é”®åº”è¯¥æ˜¯ `"gene_name"`ï¼Œä½†ä»£ç å†™çš„æ˜¯ `"gene"`ã€‚
  å› æ­¤ï¼Œå¦‚æœåˆ—è¡¨ä¸­ç¡®å®æœ‰ `"gene_name"`ï¼Œ`index("gene")` ä»ç„¶èƒ½åŒ¹é…æˆåŠŸï¼ˆå› ä¸º "gene" æ˜¯ "gene_name" çš„å‰ç¼€ï¼‰ã€‚
* å–å®ƒåä¸€ä¸ªå…ƒç´ ï¼Œå¹¶å»æ‰å¼•å·å’Œåˆ†å·ï¼Œå¾—åˆ°åŸºå› åç§°ã€‚
* å¦‚æœæ‰¾ä¸åˆ°ï¼ˆå³å‡ºç° `ValueError` å¼‚å¸¸ï¼‰ï¼Œè¯´æ˜è¿™ä¸€è¡Œæ²¡æœ‰åŸºå› åç§°å­—æ®µï¼Œåˆ™é»˜è®¤ç”¨ `gene_id` ä»£æ›¿ã€‚

ç»“æœï¼š

```python
gene_name = 'DDX11L1'
```

---

## ğŸ”¹ ä¸‰ã€æ€»ç»“é€»è¾‘æµç¨‹å›¾

| æ­¥éª¤ | æ“ä½œ                                        | ç»“æœç¤ºä¾‹                                                                                |
| -- | ----------------------------------------- | ----------------------------------------------------------------------------------- |
| 1  | æ‰¾åˆ°åŒ…å« `"transcript_id"` çš„é‚£ä¸€åˆ—ï¼ˆå³ attributesï¼‰ | `'gene_id "ENSG..."; transcript_id "ENST..."; gene_name "DDX11L1";'`                |
| 2  | ç”¨ç©ºæ ¼åˆ†å‰²æˆè¯åˆ—è¡¨                                 | `['gene_id', '"ENSG..."', 'transcript_id', '"ENST..."', 'gene_name', '"DDX11L1";']` |
| 3  | æ‰¾åˆ° `"transcript_id"` ç´¢å¼•å¹¶å–ä¸‹ä¸€ä¸ªå€¼             | `'ENST00000456328'`                                                                 |
| 4  | æ‰¾åˆ° `"gene_id"` ç´¢å¼•å¹¶å–ä¸‹ä¸€ä¸ªå€¼                   | `'ENSG00000223972'`                                                                 |
| 5  | å°è¯•æå– `"gene"` æˆ– `"gene_name"`             | `'DDX11L1'`                                                                         |
| 6  | å¦‚æœæ²¡æœ‰ gene_nameï¼Œå°±ç”¨ gene_id æ›¿ä»£              | `'ENSG00000223972'`                                                                 |

---

## ğŸ”¹ å››ã€ä¸ºä»€ä¹ˆä½œè€…è¦è¿™æ ·åš

1. **GTF ç¬¬ 9 åˆ—ä¸æ˜¯å›ºå®šç»“æ„**ï¼š
   ä¸åŒç‰ˆæœ¬çš„ GTF æ–‡ä»¶ä¸­å±æ€§é¡ºåºå¯èƒ½ä¸åŒï¼Œæœ‰çš„å¯èƒ½å†™åœ¨å‰ï¼Œæœ‰çš„åœ¨åï¼Œæ‰€ä»¥ä¸èƒ½ç”¨å›ºå®šåˆ—ç´¢å¼•ã€‚
   â†’ å› æ­¤ä½œè€…ä½¿ç”¨æ­£åˆ™æœç´¢ `re.search('transcript_id', i)` æ¥çµæ´»åŒ¹é…åŒ…å«ç›®æ ‡å…³é”®è¯çš„é‚£ä¸€åˆ—ã€‚

2. **ç”¨ç©ºæ ¼åˆ†å‰²æå–é”®å€¼**ï¼š
   GTF çš„å±æ€§åˆ—æ˜¯ç”±ç©ºæ ¼åˆ†éš”çš„é”®å€¼å¯¹å½¢å¼ï¼Œç›´æ¥ç”¨ `split(" ")` å¯å¿«é€Ÿè·å¾—é”®å’Œå€¼ã€‚

3. **ç”¨å­—ç¬¦ä¸²æ›¿æ¢æ¸…ç†æ ¼å¼**ï¼š
   æ¯ä¸ªå€¼éƒ½å¸¦æœ‰å¼•å· `"` å’Œåˆ†å· `;`ï¼Œå¿…é¡»åˆ é™¤æ‰èƒ½å¾—åˆ°å¹²å‡€çš„ IDã€‚

4. **å®¹é”™è®¾è®¡**ï¼š
   å¹¶éæ‰€æœ‰ GTF æ–‡ä»¶éƒ½åŒ…å« `gene_name` å­—æ®µï¼Œä¾‹å¦‚ä¸€äº›è‡ªåŠ¨æ³¨é‡Šçš„æ–‡ä»¶åªåŒ…å« `gene_id`ã€‚
   â†’ æ‰€ä»¥ `try-except` ç¡®ä¿å³ä½¿ç¼ºå°‘ gene_nameï¼Œä¹Ÿä¸ä¼šæŠ¥é”™ï¼Œè€Œæ˜¯è‡ªåŠ¨ä½¿ç”¨ gene_id ä»£æ›¿ã€‚

