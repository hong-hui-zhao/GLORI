
### 为什么要建立索引（详细版）

在高通量测序（NGS）中，我们通常有两类数据：

1. **参考基因组**：长度可能是几亿到几十亿碱基（例如人类基因组 ~3 Gbp）。
2. **测序 reads**：长度几十到几百碱基，每次测序可以产生上亿条 reads。

我们的任务是把每条 read 定位到参考基因组上，这看似简单，但如果直接暴力比对，每条 read 都要在整个基因组上做搜索。

* 举例：假设基因组长度 (10^9) bp，read 长度 100 bp，每条 read 的暴力比对需要约 (10^9) 次比较。
* 如果测序有 (10^8) 条 reads，总计算量就是天文数字。

因此，**必须有一种方法能快速定位 reads 的候选匹配区域，而不是扫描整个基因组**。这就是**索引（index）的作用**。

---

### 索引的核心作用

1. **加速查找候选匹配位置**

   * 索引是基因组序列经过特殊预处理后的高效数据结构。
   * 它允许比对软件在极短时间内定位某段 read 可能出现的位置，而不是逐碱基扫描整个基因组。

2. **减少计算量和内存占用**

   * 通过索引，比对软件只需对候选区域做精确比对，跳过绝大多数不可能匹配的区域。
   * 同时，压缩型索引（如 BWT）可以在较低内存下存储整个基因组信息。

3. **支持近似匹配**

   * 索引不仅能找完全匹配，还能快速锁定可能允许少量错配、插入或缺失的候选区域。

4. **重复使用**

   * 索引是针对参考基因组的预处理结果，只需建立一次，可以用于后续多次比对，避免重复计算。

---

### 常见比对软件索引方式与文件

| 软件           | 索引类型 / 数据结构                    | 索引文件示例 / 特点                                                                    |
| ------------ | ------------------------------ | ------------------------------------------------------------------------------ |
| **BWA**      | BWT + FM Index                 | `ref.fa.bwt`, `ref.fa.sa`, `ref.fa.pac`, `ref.fa.amb`, `ref.fa.ann`            |
| **Bowtie2**  | BWT + FM Index                 | `prefix.1.bt2`, `prefix.2.bt2`, `prefix.3.bt2`, `prefix.4.bt2`, `prefix.rev.*` |
| **STAR**     | Suffix Array + hash + 基因组剪接信息  | `SA`, `SAindex`, `Genome`, `chrLength.txt`, `chrName.txt` 等                    |
| **HISAT2**   | BWT + FM Index + 树状索引（处理变异/剪接） | `index_prefix.1.ht2` ~ `index_prefix.8.ht2`                                    |
| **Minimap2** | minimizer-based index（长读比对）    | `.mmi` 文件，快速支持长 reads 和基因组比对                                                   |

---

### 索引的内容细节

1. **BWT + FM Index**（BWA、Bowtie2）

   * **BWT（Burrows-Wheeler Transform）**：把基因组序列重新排列，使相同片段聚集，便于压缩和快速搜索。
   * **Suffix Array / Occurrence Table**：记录每个字符位置，便于反向回溯匹配。
   * **Checkpoint / C table**：记录每个碱基累积出现次数，快速计算匹配位置。

2. **Hash Table / Suffix Array**（STAR、HISAT2）

   * 将基因组的 k-mer（固定长度片段）做 hash，记录出现位置列表。
   * STAR 会额外记录剪接位点信息，HISAT2 会结合树状索引支持 SNP/剪接比对。

3. **Minimizer Index**（Minimap2）

   * 从参考序列抽取代表性片段（minimizers），只比对这些片段，提高长 reads 比对速度。

---

### 为什么建立索引不可或缺

* 没有索引：比对软件需要逐条 read 在整个基因组上做暴力搜索，效率极低，计算不可行。
* 有索引：比对软件只在候选区域做精确比对，利用压缩和高效查找数据结构，大幅减少计算量和内存占用，同时支持错配和剪接比对。
* 建立索引是**基因组比对的前置步骤**，它将参考基因组转化为快速查找的“目录”，保证比对在可行时间和资源内完成。

---
